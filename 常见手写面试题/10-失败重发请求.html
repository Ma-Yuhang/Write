<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script>
    // function request(url, times = 5) {
    //   return fetch(url).catch((err) => times === 1 ? Promise.reject(err) : request(url, times-1))
    // }
    function request(url, times = 3, delay = 1000) {
      return new Promise((resolve,reject) => {
        async function inner() {
          try {
            const res = await fetch(url)
            resolve(res)
          } catch (error) {
            if(times === 1) {
              reject(error)
            }else {
              setTimeout(() => {
              times--
              console.log(`正在重试，剩余次数：${times}`);
              inner()
            }, delay);
            }
          }
        }
        inner()
      })
    }


    request('https://jsonplaceholder.typiicode.com/todos/1').then((res) => {
      console.log(res, 'res');
    }).catch((err) => {
      console.log(err, 'err');
    })


  </script>
</body>

</html>